image: Visual Studio 2017

platform:
  - x64

cache:
  - node_modules
  - '%USERPROFILE%\.electron'

install:
  - ps: Install-Product node 8 x64
  - yarn

branches:
  only:
  - master
  - production
  - /^v\d+\.\d+\.\d+\-\d+$/

for:

# TAG PRERELEASE
-
  branches:
    only:
      - /^v\d+\.\d+\.\d+\-\d+$/
  environment:
    EP_PRERELEASE: true
    GH_TOKEN:
      secure: w+NI1x8/ZKHkHuCYzVbIWVvPr9eyrdR+GhwvyWGC9H3iF1MxcckziHqjeAj6ATDU
  before_build:
    - yarn test
  build_script:
    - yarn build

# TEST
-
  branches:
    only:
      - master
  test_script:
    - yarn test

# TEST + BUILD +- RELEASE
-
  branches:
    only:
      - production
  environment:
    GH_TOKEN:
      secure: w+NI1x8/ZKHkHuCYzVbIWVvPr9eyrdR+GhwvyWGC9H3iF1MxcckziHqjeAj6ATDU
  before_build:
    - yarn test
    - ps: if ($env:APPVEYOR_PULL_REQUEST_NUMBER) { set "GH_TOKEN=" }
  build_script:
    - yarn build