image: Visual Studio 2017

platform:
  - x64

cache:
  - node_modules
  - '%USERPROFILE%\.electron'
  - "%LOCALAPPDATA%\\Yarn"

install:
  - ps: Install-Product node 8 x64
  - yarn

branches:
  only:
  - master
  - production
  - /^v\d+\.\d+\.\d+\-\d+$/

for:

# TAG PRERELEASE
-
  branches:
    only:
      - /^v\d+\.\d+\.\d+\-\d+$/
  environment:
    EP_PRELEASE: true
    GH_TOKEN: 432484dc8b08f9503755733f95a20a447414d7c8
  before_build:
    - yarn test
  build_script:
    - yarn build

# TEST
-
  branches:
    only:
      - master
  test_script:
    - yarn test

# TEST + BUILD +- RELEASE
-
  branches:
    only:
      - production
  before_build:
    - yarn test
    - ps: if ($env:APPVEYOR_PULL_REQUEST_NUMBER) { set "GH_TOKEN=" }
  build_script:
    - yarn build